<section class="leads-container">
  <div class="toolbar">
    <h2>Gestión de Leads</h2>

    <div class="actions">
      <button mat-flat-button color="primary" (click)="refresh()">
        <mat-icon>refresh</mat-icon>
        Actualizar
      </button>
    </div>
  </div>

  @if (isLoading()) {
    <div class="loading">
      <mat-progress-spinner mode="indeterminate" diameter="40"></mat-progress-spinner>
    </div>
  } @else {
    <div class="table-wrapper">
      <table mat-table [dataSource]="leads()">
        <!-- ID -->
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef>ID</th>
          <td mat-cell *matCellDef="let lead">{{ lead.id }}</td>
        </ng-container>

        <!-- Nombres -->
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>Nombre</th>
          <td mat-cell *matCellDef="let lead">
            {{ lead.name }} {{ lead.lastName }}
          </td>
        </ng-container>

        <!-- DNI -->
        <ng-container matColumnDef="dni">
          <th mat-header-cell *matHeaderCellDef>DNI</th>
          <td mat-cell *matCellDef="let lead">{{ lead.dni }}</td>
        </ng-container>

        <!-- Email -->
        <ng-container matColumnDef="email">
          <th mat-header-cell *matHeaderCellDef>Email</th>
          <td mat-cell *matCellDef="let lead">{{ lead.email }}</td>
        </ng-container>

        <!-- Teléfono -->
        <ng-container matColumnDef="phone">
          <th mat-header-cell *matHeaderCellDef>Teléfono</th>
          <td mat-cell *matCellDef="let lead">{{ lead.phone }}</td>
        </ng-container>

        <!-- Ciudad -->
        <ng-container matColumnDef="city">
          <th mat-header-cell *matHeaderCellDef>Ciudad</th>
          <td mat-cell *matCellDef="let lead">{{ lead.city }}</td>
        </ng-container>

        <!-- Score -->
        <ng-container matColumnDef="lead_score">
          <th mat-header-cell *matHeaderCellDef>Score</th>
          <td mat-cell *matCellDef="let lead">
            <mat-chip [color]="'primary'" selected>
              {{ lead.lead_score }}
            </mat-chip>
          </td>
        </ng-container>

        <!-- Estado -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Estado</th>
          <td mat-cell *matCellDef="let lead">
            <span class="status">{{ lead.status | titlecase }}</span>
          </td>
        </ng-container>

        <!-- Acciones -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let lead">
            <button
              mat-icon-button
              color="primary"
              matTooltip="Ver detalles"
              (click)="viewLead(lead)"
            >
              <mat-icon>visibility</mat-icon>
            </button>

            <button
              mat-icon-button
              color="warn"
              matTooltip="Eliminar"
              (click)="deleteLead(lead.id!)"
            >
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>
    </div>
  }
</section>
